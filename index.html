import cv2
import numpy as np

# Đọc ảnh
image = cv2.imread("aefec5fd-7f4f-419b-8028-ef4d292a675a.png")
if image is None:
    raise FileNotFoundError("Không tìm thấy ảnh. Hãy chắc chắn rằng file nằm cùng thư mục với code.")

# Chuyển sang grayscale
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)

# Làm mờ để giảm nhiễu
blur = cv2.GaussianBlur(gray, (5, 5), 0)

# Phát hiện biên Canny
edges = cv2.Canny(blur, 50, 150)

# Tìm contours
contours, _ = cv2.findContours(edges, cv2.RETR_TREE, cv2.CHAIN_APPROX_SIMPLE)

hexagons = []

for contour in contours:
    # Approximate polygon
    epsilon = 0.02 * cv2.arcLength(contour, True)
    approx = cv2.approxPolyDP(contour, epsilon, True)

    # Nếu là 6 cạnh → hexagon
    if len(approx) == 6 and cv2.isContourConvex(approx):
        hexagons.append(approx)
        cv2.drawContours(image, [approx], -1, (0, 255, 0), 3)

        # Vẽ tọa độ từng đỉnh
        for idx, point in enumerate(approx):
            x, y = point[0]
            cv2.circle(image, (x, y), 5, (0, 0, 255), -1)
            cv2.putText(image, f"{idx+1}:({x},{y})", (x+10, y-10),
                        cv2.FONT_HERSHEY_SIMPLEX, 0.5, (255, 0, 0), 2)

# Xuất kết quả
print(f"Tìm thấy {len(hexagons)} hình lục giác.")

cv2.imshow("Hexagon Detection", image)
cv2.waitKey(0)
cv2.destroyAllWindows()
